<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="demo.juster.spboot.mapper.UserMapper"><!-- 关联到DAO interface -->
 
    <resultMap id="UserMap" type="User">
        <id column="id" jdbcType="BIGINT" javaType="long" property="id" />
        <result column="username" jdbcType="VARCHAR" javaType="string" property="name" />
        <result column="pwd" jdbcType="VARCHAR" javaType="string" property="pwd" />
        <collection column="{roleId=roles_id}" select="getRoles" property="roles" ofType="Role" > 
   		</collection>
    </resultMap>
    
     <resultMap id="UserMapSimple" type="User">
        <id column="id" jdbcType="BIGINT" javaType="long" property="id" />
        <result column="username" jdbcType="VARCHAR" javaType="string" property="name" />
        <result column="pwd" jdbcType="VARCHAR" javaType="string" property="pwd" />
    </resultMap>
    
    <resultMap id="RoleMap" type="Role">
	    <id column="id" jdbcType="BIGINT" javaType="long" property="id" />
	    <result column="rolename" jdbcType="VARCHAR" property="rolename" />
	</resultMap>
    
    <select id="getRoles"  resultMap="RoleMap">
	    select id,rolename
	    from role r
	    where  r.ID = #{roleId,jdbcType =BIGINT};
	</select>
 
    <select id="findById" resultMap="UserMap">
        select u.id,ur.roles_id,u.username,u.pwd from user u,user_roles ur where u.id = #{id} and ur.user_id = u.id
    </select>
    
    <select id="findByName" resultMap="UserMap">
    	select u.id,ur.roles_id,u.username,u.pwd from user u,user_roles ur where u.username = #{name} and ur.user_id = u.id
    </select>

	  <select id="findAll" resultMap="UserMapSimple">
	        select * from  user
	  </select>
	  
	  <delete id="deleteById" parameterType="int">  
        delete from user u where u.id = #{id}  
	  </delete>  

	<insert id="save" parameterType="User" useGeneratedKeys="true" keyProperty="id">
		insert into user (id,username,pwd)  
              values   (#{id},#{username},#{pwd})  
	</insert>
	
	
</mapper>